<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>phenom.spectrum &mdash; phenom 0.0.2.post0.dev0+g4264519 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            phenom
          </a>
              <div class="version">
                0.0.2.post0.dev0+g4264519
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../min_versions.html">Minimum Version of Python and NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-history.html">Release History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">phenom</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">phenom.spectrum</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for phenom.spectrum</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">fft</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">e</span><span class="p">,</span> <span class="n">h</span>

<span class="kn">from</span> <span class="nn">phenom.gaussian</span> <span class="kn">import</span> <span class="n">gaussian_1d</span>

<span class="n">h_eV_s</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">e</span>
<span class="n">hr_eV_s</span> <span class="o">=</span> <span class="n">h_eV_s</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="linear_SASE_spectrum"><a class="viewcode-back" href="../../api.html#phenom.spectrum.linear_SASE_spectrum">[docs]</a><span class="k">def</span> <span class="nf">linear_SASE_spectrum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pulse_duration</span><span class="p">,</span> <span class="n">photon_energy</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="mf">1e-04</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a single SASE (Self-Amplified Spontaneous Emission) pulse profile.</span>

<span class="sd">    This function assumes that both the spectral and temporal profiles are Gaussian. The current implementation does not consider any jitter from the central value of the Gaussian, meaning the pulse profile is considered persistent.</span>

<span class="sd">    Future extensions to this function might include the ability to handle non-Gaussian profiles and pulse-length jitter, as well as the trimming of the function to relevant regions to reduce the number of points.</span>

<span class="sd">    :param t: numpy.ndarray</span>
<span class="sd">        Time axis of the pulse. Represents the time range over which the pulse is defined.</span>

<span class="sd">    :param pulse_duration: float</span>
<span class="sd">        Expected full width at half maximum (FWHM) value of the SASE pulse time, in seconds.</span>

<span class="sd">    :param photon_energy: float</span>
<span class="sd">        Central energy of the pulse, in electronvolts.</span>

<span class="sd">    :param bandwidth: float, optional</span>
<span class="sd">        Energy bandwidth relative to the pulse. Represents the spread in energy of the pulse.</span>
<span class="sd">        Default is 1e-04.</span>

<span class="sd">    :param t0: float, optional</span>
<span class="sd">        Timing jitter, which should generally be less than twice the product of the sampling rate and the bandwidth.</span>
<span class="sd">        Default is 0.</span>

<span class="sd">    :return: numpy.ndarray</span>
<span class="sd">        The complex spectrum of the SASE pulse, represented as a 1D array.</span>

<span class="sd">    :Description:</span>
<span class="sd">        The function begins by defining several parameters including the pulse duration in terms of standard deviation, the bandwidth in absolute terms, the energy range (E), and the corresponding time-domain (et).</span>
<span class="sd">        It then calculates the temporal and spectral envelopes using a Gaussian function (assumed to be `gaussian_1d` within the function&#39;s scope).</span>
<span class="sd">        Random phases are introduced to the spectral envelope, and the final spectrum is computed using a Fourier transform.</span>
<span class="sd">        The resulting spectrum is normalized so that the area under the intensity curve is 1.</span>

<span class="sd">    :Note:</span>
<span class="sd">        - The `gaussian_1d` function, used to define the temporal and spectral envelopes, should be available in the scope of this function.</span>
<span class="sd">        - Constants like `hr_eV_s` used for unit conversion should also be defined.</span>
<span class="sd">        - The provided time axis &#39;t&#39; should be a 1D array with an appropriate range to represent the pulse profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">pulse_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pulse_duration</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">bw</span> <span class="o">=</span> <span class="n">photon_energy</span> <span class="o">*</span> <span class="n">bandwidth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">photon_energy</span> <span class="o">-</span> <span class="n">bw</span><span class="p">,</span> <span class="n">photon_energy</span> <span class="o">+</span> <span class="n">bw</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>  <span class="c1">### bandwidthfine frequency/energy domain</span>

    <span class="n">estep</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">hr_eV_s</span>  <span class="c1">### step size of freq domain</span>

    <span class="n">et</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">estep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">estep</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>  <span class="c1">### bandwidthfine time-domain</span>

    <span class="n">temporal_envelope</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="n">gaussian_1d</span><span class="p">(</span><span class="n">et</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">pulse_duration</span><span class="p">)</span>

    <span class="n">spectral_envelope</span> <span class="o">=</span> <span class="n">gaussian_1d</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">photon_energy</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span>

    <span class="n">random_phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">temporal_envelope</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">spectral_envelope</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">random_phases</span><span class="p">)))</span> <span class="o">*</span> <span class="n">temporal_envelope</span>
    <span class="n">spectrum</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">spectrum</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1">### normalise area under intensity curve to 1</span>

    <span class="k">return</span> <span class="n">spectrum</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">linear_SASE_spectrum</span><span class="p">(</span><span class="n">pulse_duration</span><span class="o">=</span><span class="mf">25e-15</span><span class="p">,</span> <span class="n">photon_energy</span><span class="o">=</span><span class="mi">9500</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">nt</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1">#     from scipy.optimize import curve_fit</span>
<span class="c1">#     p,_ = curve_fit(gaussian_1d, res[0], res[1],p0 = [0, np.std(res[0])])</span>
<span class="c1">#     plt.plot(res[0], gaussian_1d(res[0],*p))</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Trey Guest.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>